import O,{Fragment as J,createContext as B,useCallback as U,useContext as N,useMemo as I,useReducer as Q,useRef as _,useEffect as G}from"react";import{render as v,Features as K,forwardRefWithAs as M}from"../../utils/render.js";import{useId as z}from"../../hooks/use-id.js";import{match as $}from"../../utils/match.js";import{Keys as y}from"../../components/keyboard.js";import{focusIn as E,Focus as P}from"../../utils/focus-management.js";import{useIsoMorphicEffect as k}from"../../hooks/use-iso-morphic-effect.js";import{useSyncRefs as D}from"../../hooks/use-sync-refs.js";import{useResolveButtonType as X}from"../../hooks/use-resolve-button-type.js";import{useLatestValue as V}from"../../hooks/use-latest-value.js";import{FocusSentinel as Y}from"../../internal/focus-sentinel.js";var Z=(r=>(r[r.SetSelectedIndex=0]="SetSelectedIndex",r[r.SetOrientation=1]="SetOrientation",r[r.SetActivation=2]="SetActivation",r[r.RegisterTab=3]="RegisterTab",r[r.UnregisterTab=4]="UnregisterTab",r[r.RegisterPanel=5]="RegisterPanel",r[r.UnregisterPanel=6]="UnregisterPanel",r[r.ForceRerender=7]="ForceRerender",r))(Z||{});let ee={[0](e,t){return e.selectedIndex===t.index?e:{...e,selectedIndex:t.index}},[1](e,t){return e.orientation===t.orientation?e:{...e,orientation:t.orientation}},[2](e,t){return e.activation===t.activation?e:{...e,activation:t.activation}},[3](e,t){return e.tabs.includes(t.tab)?e:{...e,tabs:[...e.tabs,t.tab]}},[4](e,t){return{...e,tabs:e.tabs.filter(i=>i!==t.tab)}},[5](e,t){return e.panels.includes(t.panel)?e:{...e,panels:[...e.panels,t.panel]}},[6](e,t){return{...e,panels:e.panels.filter(i=>i!==t.panel)}},[7](e){return{...e}}},W=B(null);W.displayName="TabsContext";let j=B(null);j.displayName="TabsSSRContext";function F(e){let t=N(W);if(t===null){let i=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,F),i}return t}function te(e,t){return $(t.type,ee,e,t)}let ne=J,re=M(function(t,i){let{defaultIndex:u=0,vertical:x=!1,manual:d=!1,onChange:f,selectedIndex:l=null,...r}=t;const p=x?"vertical":"horizontal",T=d?"manual":"auto";let c=D(i),[a,o]=Q(te,{selectedIndex:typeof window=="undefined"?l!=null?l:u:null,tabs:[],panels:[],orientation:p,activation:T}),R=I(()=>({selectedIndex:a.selectedIndex}),[a.selectedIndex]),L=V(f||(()=>{})),S=V(a.tabs);G(()=>{o({type:1,orientation:p})},[p]),G(()=>{o({type:2,activation:T})},[T]),k(()=>{if(a.tabs.length<=0||l===null&&a.selectedIndex!==null)return;let s=a.tabs.map(n=>n.current).filter(Boolean),b=s.filter(n=>!n.hasAttribute("disabled")),m=l!=null?l:u;if(m<0)o({type:0,index:s.indexOf(b[0])});else if(m>a.tabs.length)o({type:0,index:s.indexOf(b[b.length-1])});else{let n=s.slice(0,m),C=[...s.slice(m),...n].find(q=>b.includes(q));if(!C)return;o({type:0,index:s.indexOf(C)})}},[u,l,a.tabs,a.selectedIndex]);let A=_(a.selectedIndex);G(()=>{A.current=a.selectedIndex},[a.selectedIndex]);let h=I(()=>[a,{dispatch:o,change(s){A.current!==s&&L.current(s),A.current=s,o({type:0,index:s})}}],[a,o]),w=_(0),H={ref:c};return O.createElement(j.Provider,{value:typeof window=="undefined"?w:null},O.createElement(W.Provider,{value:h},O.createElement(Y,{onFocus:()=>{var s,b;for(let m of S.current)if(((s=m.current)==null?void 0:s.tabIndex)===0)return(b=m.current)==null||b.focus(),!0;return!1}}),v({ourProps:H,theirProps:r,slot:R,defaultTag:ne,name:"Tabs"})))}),ae="div",le=M(function(t,i){let[{selectedIndex:u,orientation:x}]=F("Tab.List"),d=D(i);return v({ourProps:{ref:d,role:"tablist","aria-orientation":x},theirProps:t,slot:{selectedIndex:u},defaultTag:ae,name:"Tabs.List"})}),oe="button",ie=M(function(t,i){var b,m;let u=`headlessui-tabs-tab-${z()}`,[{selectedIndex:x,tabs:d,panels:f,orientation:l,activation:r},{dispatch:p,change:T}]=F("Tab"),c=_(null),a=D(c,i,n=>{!n||p({type:7})});k(()=>(p({type:3,tab:c}),()=>p({type:4,tab:c})),[p,c]);let o=d.indexOf(c),R=o===x,L=U(n=>{let g=d.map(C=>C.current).filter(Boolean);if(n.key===y.Space||n.key===y.Enter){n.preventDefault(),n.stopPropagation(),T(o);return}switch(n.key){case y.Home:case y.PageUp:return n.preventDefault(),n.stopPropagation(),E(g,P.First);case y.End:case y.PageDown:return n.preventDefault(),n.stopPropagation(),E(g,P.Last)}return $(l,{vertical(){if(n.key===y.ArrowUp)return E(g,P.Previous|P.WrapAround);if(n.key===y.ArrowDown)return E(g,P.Next|P.WrapAround)},horizontal(){if(n.key===y.ArrowLeft)return E(g,P.Previous|P.WrapAround);if(n.key===y.ArrowRight)return E(g,P.Next|P.WrapAround)}})},[d,l,o,T]),S=U(()=>{var n;(n=c.current)==null||n.focus()},[c]),A=U(()=>{var n;(n=c.current)==null||n.focus(),T(o)},[T,o,c]),h=U(n=>{n.preventDefault()},[]),w=I(()=>({selected:R}),[R]),H=t,s={ref:a,onKeyDown:L,onFocus:r==="manual"?S:A,onMouseDown:h,onClick:A,id:u,role:"tab",type:X(t,c),"aria-controls":(m=(b=f[o])==null?void 0:b.current)==null?void 0:m.id,"aria-selected":R,tabIndex:R?0:-1};return v({ourProps:s,theirProps:H,slot:w,defaultTag:oe,name:"Tabs.Tab"})}),se="div",ue=M(function(t,i){let[{selectedIndex:u}]=F("Tab.Panels"),x=D(i),d=I(()=>({selectedIndex:u}),[u]);return v({ourProps:{ref:x},theirProps:t,slot:d,defaultTag:se,name:"Tabs.Panels"})}),ce="div",pe=K.RenderStrategy|K.Static,de=M(function(t,i){var S,A;let[{selectedIndex:u,tabs:x,panels:d},{dispatch:f}]=F("Tab.Panel"),l=N(j);l!==null&&u===null&&(u=0);let r=`headlessui-tabs-panel-${z()}`,p=_(null),T=D(p,i,h=>{!h||f({type:7})});k(()=>(f({type:5,panel:p}),()=>f({type:6,panel:p})),[f,p]);let c=d.indexOf(p),a=l===null?c===u:l.current++===u,o=I(()=>({selected:a}),[a]),R=t,L={ref:T,id:r,role:"tabpanel","aria-labelledby":(A=(S=x[c])==null?void 0:S.current)==null?void 0:A.id,tabIndex:a?0:-1};return v({ourProps:L,theirProps:R,slot:o,defaultTag:ce,features:pe,visible:a,name:"Tabs.Panel"})}),_e=Object.assign(ie,{Group:re,List:le,Panels:ue,Panel:de});export{_e as Tab};
